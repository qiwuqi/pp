name: â° è‡ªåŠ¨æŠ“å–ä»£ç†åˆ—è¡¨

on:
  schedule:
    - cron: '0 */4 * * *'  # æ¯ 4 å°æ—¶æ‰§è¡Œä¸€æ¬¡
  workflow_dispatch:

jobs:
  fetch-proxies:
    runs-on: ubuntu-latest

    steps:
      - name: â¬‡ï¸ æ‹‰å–ä»“åº“ä»£ç 
        uses: actions/checkout@v3

      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: npm install

      - name: ğŸ•µï¸â€â™‚ï¸ æŠ“å–ä»£ç†å¹¶ç”Ÿæˆæ–‡ä»¶ï¼ˆå¸¦é‡è¯•æœºåˆ¶ï¼‰
        run: |
          n=0
          until [ $n -ge 3 ]; do
            echo "ç¬¬ $((n+1)) æ¬¡å°è¯•..."
            node proxy-fetcher/fetch-proxies.mjs && break
            echo "å¤±è´¥ï¼Œ3 ç§’åé‡è¯•..."
            n=$((n+1))
            sleep 3
          done
        timeout-minutes: 3  # æœ€é•¿æ‰§è¡Œæ—¶é—´ 3 åˆ†é’Ÿ

- name: ğŸ” æ¨é€æ›´æ–°
  run: |
    git config --global user.name "github-actions[bot]"
    git config --global user.email "github-actions[bot]@users.noreply.github.com"
    git remote set-url origin https://x-access-token:${{ secrets.GH_TOKEN }}@github.com/${{ github.repository }}.git
    git add proxy-list.txt
    git commit -m "ğŸ¤– è‡ªåŠ¨æ›´æ–°ä»£ç†åˆ—è¡¨ $(date '+%Y-%m-%d %H:%M:%S')" || echo "No changes to commit"
    git push origin main
  env:
    GH_TOKEN: ${{ secrets.GH_TOKEN }}

